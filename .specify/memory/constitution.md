<!--
  Sync Impact Report
  Version change: (template placeholders) → 1.0.0
  Modified principles: All placeholders replaced with concrete principles for npm workspaces monorepo (Blog).
  Added sections: Technology & Shared Infrastructure, Development Workflow (replacing generic SECTION_2/SECTION_3).
  Removed sections: None.
  Templates: plan-template.md ✅ (Constitution Check updated to reference principles I–V); spec-template.md ✅ (scope/requirements align);
  tasks-template.md ✅ (TDD/test discipline and path conventions align; monorepo paths packages/* can be inferred).
  Commands: N/A (no .specify/templates/commands/ directory).
  Follow-up TODOs: None.
-->
# Blog Monorepo Constitution

## Core Principles

### I. Monorepo & Package Layout

- The repository MUST use npm workspaces.
- Every package MUST live under the `packages/` directory.
- Shared code (utilities, types, config) MUST be provided via shared modules consumed by packages; no duplicate implementations of the same concern across packages.
- Build and tooling configuration MUST be shared where possible (e.g. TypeScript, lint, test config) to keep packages consistent and reduce drift.

*Rationale*: A single layout and shared infrastructure reduce cognitive load, ease refactors, and keep the builder/viewer pipeline coherent.

### II. TypeScript Everywhere

- All packages MUST use TypeScript for application and test code.
- Shared types and contracts (e.g. blog-builder output schema) MUST be expressed in TypeScript and reused by both blog-builder and blog-viewer where applicable.

All application code MUST use ECMAScript Modules (`"type": "module"` in
`package.json`) and TypeScript with strict compiler options enabled.

- `strict: true` in `tsconfig.json` is non-negotiable.
- All `noImplicit*` and `noUnused*` flags MUST remain enabled.
- Explicit `any` is forbidden; use `unknown` with type narrowing instead.
- Module resolution MUST use `NodeNext` to match the ESM runtime.
- Imports MUST include the `.ts` extension for intra-project references
  (enforced by `allowImportingTsExtensions`).

*Rationale*: One language and shared types prevent schema drift and improve maintainability across the static pipeline.

### III. Test-First (TDD)

- Tests MUST be written and approved **before** the production code they
  validate.
- Vitest MUST remain the primary test runner for unit and integration tests.
- Supplemental testing tools MAY be introduced only when they preserve the
  Red-Green-Refactor workflow, required coverage thresholds, and CI quality
  gates defined in this constitution.
- The `given / when / then` comment structure MUST be used in every test case
  to clearly separate setup, action, and assertion.

### IV. Builder–Viewer Contract

- **blog-builder** produces JSON (and related artifacts) that summarize static content; **blog-viewer** consumes those artifacts to render the site.
- The shape and semantics of generated JSON (and any shared schema) MUST be explicitly defined and stable; breaking changes require a migration path and versioning consideration.
- Contract or integration tests MUST cover the producer (blog-builder) and consumer (blog-viewer) boundary when the contract or behaviour changes.

*Rationale*: A clear, tested contract prevents silent breakage between the CLI pipeline and the React app.

### V. Modular CLI & Static Pipeline

- **blog-builder** MUST be implemented as a modular CLI: digesting static files (e.g. markdown, assets) and emitting JSON (and other) summaries; modules MUST be composable and testable in isolation.
- **blog-viewer** MUST be a React application that displays static content and MUST use the files generated by blog-builder to populate the displayed page; it MUST NOT re-implement digest logic that belongs in blog-builder.

*Rationale*: Separation of concerns keeps the pipeline maintainable and allows independent evolution of build vs. view layers.

## Technology & Shared Infrastructure

- **Language**: TypeScript across all packages.
- **Package manager**: npm with workspaces; root and package `package.json` MUST be consistent with workspace definitions.
- **Build & tooling**: Shared TypeScript, lint, and test configuration (e.g. under a shared config package or root config) MUST be used by all packages to avoid divergence.
- **Testing**: A single test runner and TDD workflow MUST be used; contract and integration tests MUST run in CI for the builder–viewer boundary.

## Development Workflow

- **TDD**: Write or approve tests first; run tests (red), implement (green), refactor; do not commit behaviour changes without corresponding tests.
- **Shared config**: Changes to shared build or lint config MUST be validated across all packages (e.g. root-level or workspace-wide scripts).
- **Contract changes**: Any change to the format or semantics of blog-builder output MUST be reflected in types/schemas, tests, and blog-viewer usage; contract or integration tests MUST be updated and passing before merge.

## Feature Development Cycle

1. **Specify** — define user stories with acceptance scenarios (Given/When/Then).
2. **Plan** — produce implementation plan with constitution check, data model,
   and contracts.
3. **Test (Red)** — write failing tests covering the acceptance scenarios.
4. **Implement (Green)** — write minimum code to pass all tests.
5. **Refactor** — improve code quality while keeping tests green.
6. **Install** — run `npm ci` once at repository root for deterministic
   dependency resolution in CI and local clean runs.
7. **Verify** — run `npm run verify -w <workspace-name>` from repo root
   (or `npm run verify` inside an adapter directory). To verify all packages:
   `npm run verify --workspaces`.
8. **Review** — PR must reference the spec and pass all CI checks.

## Governance

- This constitution supersedes ad-hoc practices; all new work MUST align with these principles.
- Amendments require: a documented proposal, version bump per semantic versioning below, and (where applicable) a migration plan for existing code or contracts.
- **Versioning**: MAJOR = backward-incompatible governance or principle removals/redefinitions; MINOR = new principle or materially expanded section; PATCH = clarifications, typos, non-semantic wording.
- All PRs and reviews MUST verify compliance with the constitution; deviations MUST be justified and recorded (e.g. in plan or spec).

**Version**: 1.0.0 | **Ratified**: 2025-02-26 | **Last Amended**: 2025-02-26
